# 该配置文件描述 Office-Home 本地训练与分析的默认超参,为了画出那张text和image分的很开的图片，
# 可根据 GPU/数据路径修改对应字段
data:
  office_home_root: /data1/lc/data/office_home
  domainnet_root: /data1/lc/data/domainnet
domains:
  - Art
  - Clipart
  - Product
  - Real_World  # 数据文件夹命名为 Real_World

client_mapping:
  art: 0
  clipart: 0
  product: 1
  real_world: 1

train:
  batch_size: 64
  num_workers: 4
  
  # === 关键修改：控制时长的逻辑 ===
  # 在 Config 里把 Epochs 设得非常大（比如 1000），然后用 max_train_steps 来作为真正的刹车片。
  epochs: 1000           # 设一个虚大的值，防止 Epoch 耗尽提前停止
  max_train_steps: 1000  # 【听这个参数的】跑完 1000 步（约 27 Epochs）自动结束
  
  # === 关键修改：保存频率 ===
  snapshot_steps: 50     # 每 50 步保存一次 LoRA 参数
                         # 这样 1000 步你会得到 20 个点，足够画出漂亮的曲线图了
  
  checkpoint_steps: 1000 # 完整模型只在最后保存一次，省硬盘
  
  learning_rate: 1.0e-4
  weight_decay: 0.01
  grad_clip: 1.0
  logging_steps: 10
  lr_scheduler: cosine
  warmup_ratio: 0.05
  save_dir: checkpoints
  log_dir: logs
  fp16: true

lora:
  r: 16
  alpha: 32
  dropout: 0.05
  target_modules:
    - q_proj
    - v_proj
    - k_proj

client_mapping:
  art: 0
  clipart: 0
  product: 1
  real_world: 1

server:
  gpu: 2
  svd_rank: 32
  eval_split: domainnet/clipart

